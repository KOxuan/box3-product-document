# 教程：一份代码，打包出“普通版”和“活动版”

## 你的地图要办“圣诞节活动”了！

想象一下，你的地图《梦想小镇》非常受欢迎。为了迎接圣诞节，你准备推出一个“圣诞特别版”。这个版本需要：

- 一个全新的、飘着雪花的 UI 界面。
- 一个“寻找圣诞老人”的特殊任务。
- 普通版本的功能暂时要屏蔽掉。

你遇到的第一个问题就是：**我该怎么做？**

- **方案 A（最笨的办法）**：把整个项目复制一份，改名为 `梦想小镇-圣诞版`，然后在新项目里大改特改。

  - **后果**：活动结束后，你还要手动把新功能合并回原项目，过程痛苦还容易出错。两个项目同时存在，维护成本翻倍。

- **方案 B（聪明的办法）**：只用**一份代码**，通过修改配置，让它可以打包出`普通版.js`和`圣诞版.js`两个不同的文件。

这正是 ArenaPro 中“多入口”或“分包”功能的用武之地。它能让你像变魔术一样，用同一套源码，构建出不同版本。

## 魔法揭秘：`dao3.config.json`

我们所有的“魔法”都发生在一个核心配置文件里：`dao3.config.json`。

在这个文件中，有一个叫做 `outputAndUpdate` 的关键设置项。它就像一份“构建蓝图”，你可以在里面定义所有你想要打包的版本。

### 实战演练：从一个版本到两个版本

假设你项目原来的目录结构很简单：

```
src/
├── server.ts  # 服务端主入口
└── client.ts  # 客户端主入口
```

`dao3.config.json` 里的配置可能长这样：

```jsonc
// dao3.config.json
{
  "ArenaPro": {
    "file": {
      "outputAndUpdate": [
        // --- 蓝图 1: 普通版 ---
        {
          "name": "index.js", // 打包后的文件名
          "serverEntry": "src/server.ts",
          "clientEntry": "src/client.ts"
        }
      ]
    }
  }
}
```

现在，我们要加入“圣诞版”：

**第一步：创建圣诞版的专属代码文件**

在 `src/` 目录下创建一个新的 `xmas/` 文件夹，用来存放所有圣诞节活动的专属代码。

```
src/
├── server.ts
├── client.ts
└── xmas/       # 圣诞活动代码
    ├── server.ts  // 圣诞版的服务端入口
    └── client.ts  // 圣诞版的客户端入口（比如加载雪花 UI）
```

在 `xmas/client.ts` 里，你可以写一些完全不同的 UI 逻辑。

**第二步：在“蓝图”中添加新版本**

现在，我们修改 `dao3.config.json`，在 `outputAndUpdate` 数组里，加入“圣诞版”的构建蓝图。

```jsonc
// dao3.config.json
{
  "ArenaPro": {
    "file": {
      "outputAndUpdate": [
        // --- 蓝图 1: 普通版 (保持不变) ---
        {
          "name": "index.js",
          "serverEntry": "src/server.ts",
          "clientEntry": "src/client.ts",
          "description": "《梦想小镇》的常规版本"
        },
        // --- 蓝图 2: 圣诞版 (这是新增的) ---
        {
          "name": "xmas.js", // 新版本打包后的文件名
          "serverEntry": "src/xmas/server.ts", // 指向圣诞版的入口
          "clientEntry": "src/xmas/client.ts", // 指向圣诞版的入口
          "description": "《梦想小C镇》的圣诞特别版，包含特殊任务和UI"
        }
      ]
    }
  }
}
```

**小贴士**：强烈建议为每个版本都加上 `description` 字段。这个描述会在你打包时显示出来，帮你分清要构建哪个版本。

## 如何打包出你想要的版本？

配置好了蓝图，接下来的操作就非常简单了。

- 你选择 “index.js”，它就只打包普通版。
- 你选择 “xmas.js”，它就只打包圣诞版。

你再也不用担心搞混了！

### 在 HMR（热更新）模式下

HMR 模式更加智能。当你启动 HMR 后，它会**同时监视和编译你定义的所有版本**。

- 你在本地修改了 `xmas/client.ts`，HMR 会立刻重新编译出最新的 `xmas.js`。
- 此时，如果你在神岛编辑器里打开的是配置为加载 `xmas.js` 的地图，游戏画面就会被自动热更新。

你无需进行任何手动切换，HMR 会根据你当前编辑的地图所需的文件，自动完成同步。

## 总结

通过使用 `outputAndUpdate` 配置，你掌握了一个强大的能力：

- **单一代码库，多重输出**：用同一份代码，维护普通版、活动版、测试版等多个版本。
- **关注点分离**：不同版本的专属逻辑被清晰地分在了不同的文件夹里，代码结构更清晰。
- **安全构建**：通过图形化的选择框来打包，有效避免了手动修改配置可能带来的失误。

现在，你可以放心地为你的地图准备各种各样的活动版本了！
