# ArenaPro UI ç´¢å¼•ä½¿ç”¨æŒ‡å—

## è¿˜åœ¨ä¸ºâ€œè·¯å¾„åœ°ç‹±â€æŠ“ç‹‚ï¼Ÿ

> ä½ åœ¨ UI æ ‘é‡Œæ‰¾èŠ‚ç‚¹ï¼Œè·¯å¾„å±‚çº§æ·±ã€å‘½åä¸ç»Ÿä¸€ã€æ”¹äº†ç»“æ„å°±å…¨å´©ã€‚æ¯æ¬¡éƒ½æ˜¯ï¼š
>
> - â€œè¦æ‹¿åˆ° `uiText_content1`ï¼Œæ¯æ¬¡éƒ½å¾—æ‹¼ `blackground/.../box/list/0/...` è¿™ç§é•¿è·¯å¾„ã€‚â€
> - â€œè®¾è®¡æŠŠ `panel` æŒªè¿›äº† `container`ï¼Œç»“æœæˆ‘æ‰€æœ‰å­—ç¬¦ä¸²è·¯å¾„éƒ½è¦è·Ÿç€æ”¹ä¸€éã€‚â€
> - â€œæˆ‘åªæƒ³ç›´æ¥æ‹¿åˆ°å…ƒç´ å¼•ç”¨ï¼Œä¸æƒ³ç»´æŠ¤æ·±å±‚çº§çš„å­—ç¬¦ä¸²è·¯å¾„ã€‚â€

ä» V1.4.0 å¼€å§‹ï¼ŒArenaPro æä¾›äº†â€œUI ç´¢å¼•â€èƒ½åŠ›â€”â€”åƒçœ‹â€œåœ°å›¾ç´¢å¼•â€ä¸€æ ·ï¼Œé€šè¿‡â€œå±å¹•å + èŠ‚ç‚¹åâ€ç›´è¾¾ç›®æ ‡å…ƒç´ ï¼Œä¸å†è¢«è·¯å¾„å›°ä½ã€‚

### ç¤ºä¾‹

```ts
// è¿‡å»ï¼ˆè·¯å¾„åœ°ç‹±ï¼‰ï¼šä»»ä½•ç»“æ„å˜åŒ–éƒ½è¦æ‰‹æ”¹å­—ç¬¦ä¸²è·¯å¾„
const el = UiScreen.getAllScreen()
  .find((e) => e.name === "blackground")
  .findChildByName("blackground")
  .findChildByName("root")
  .findChildByName("container")
  .findChildByName("panel")
  .findChildByName("box")
  .findChildByName("unit")
  .findChildByName("list")
  .findChildByName("0")
  .findChildByName("content")
  .findChildByName("uiText_content1");
console.log(el?.name);

// ç°åœ¨ï¼ˆUI ç´¢å¼•ï¼‰ï¼šæŒ‰â€œå±å¹•å + èŠ‚ç‚¹åâ€å¼ºç±»å‹ç›´è¾¾
const idx = find("blackground");
console.log(idx?.uiText_content1.name); // å¼ºç±»å‹ã€è‡ªåŠ¨è¡¥å…¨ã€ç»“æ„è°ƒæ•´ååªéœ€é‡æ–°åŒæ­¥ç´¢å¼•
```

## UI ç´¢å¼•èƒ½å¸¦æ¥ä»€ä¹ˆï¼Ÿ

UI ç´¢å¼•æ˜¯å¯¹ UI æ ‘çš„â€œå¼ºç±»å‹æŠ•å½±â€ã€‚å®ƒä¼šä¸ºæ¯ä¸ªå±å¹•ç”Ÿæˆä¸€ä¸ªç´¢å¼•ç±»ï¼Œå¹¶æä¾›ç»Ÿä¸€å…¥å£æ¥æŸ¥æ‰¾ç´¢å¼•å®ä¾‹ï¼š

| ä½ å°†è·å¾—â€¦               | å®ƒæ„å‘³ç€â€¦                                                                          |
| ----------------------- | ---------------------------------------------------------------------------------- |
| **ğŸ” å¼ºç±»å‹ç›´è¾¾å…ƒç´ **   | é€šè¿‡å±æ€§è®¿é—® UI å…ƒç´ ï¼ŒIDE è‡ªåŠ¨è¡¥å…¨ã€ç±»å‹å¯è§ã€‚                                     |
| **ğŸ§­ è„±ç¦»è·¯å¾„ä¾èµ–**     | ä¸å†æ‰‹å†™å­—ç¬¦ä¸²è·¯å¾„ï¼Œç»“æ„è°ƒæ•´ä¹Ÿä¸å¿…æ‰¹é‡æ”¹è·¯å¾„å­—ç¬¦ä¸²ã€‚                               |
| **âš¡ é¦–æ¬¡é¢„çƒ­ï¼Œåç»­å¿«** | æ„é€ æ—¶æŒ‰è·¯å¾„è¡¨ä¸€æ¬¡æ€§é¢„çƒ­ç¼“å­˜ï¼Œåç»­è®¿é—®æ— éœ€å†æŸ¥æ‰¾ã€‚                                 |
| **ğŸ§© å‘½åå†²çªæ¶ˆè§£**     | è‡ªåŠ¨é‡‡ç”¨æœ«çº§å/å›é€€å…¨è·¯å¾„/å†è¿½åŠ åºå·ï¼Œæœ€å¤§åŒ–è·å¾—â€œå¥½ç”¨çš„å±æ€§åâ€ã€‚                   |
| **âœ… ç±»å‹å³è§„èŒƒ**       | ä¸å­˜åœ¨çš„å±å¹•åœ¨ç±»å‹ä¸Šç›´æ¥æ˜¯ `never`ï¼Œé—®é¢˜åœ¨ç¼–è¯‘æœŸæš´éœ²ï¼›è¿è¡Œæ—¶ç¼ºå¤±è¿”å› `undefined`ã€‚ |

> æ ¸å¿ƒä¼˜åŠ¿ï¼šUI ç´¢å¼•ç”±æ’ä»¶è‡ªåŠ¨ç”Ÿæˆå’Œç»´æŠ¤ã€‚ä½ åªéœ€æŒ‰â€œå±å¹•åâ€è·å–ç´¢å¼•å®ä¾‹ï¼Œå‰©ä¸‹çš„äº¤ç»™ç±»å‹ç³»ç»Ÿä¸ç¼“å­˜æœºåˆ¶ã€‚

### ç¤ºä¾‹

```ts
import find from "@client/UiIndex";
const idx = find("home");

// 1) å¼ºç±»å‹ç›´è¾¾å…ƒç´ ï¼ˆIDE è‡ªåŠ¨è¡¥å…¨ï¼‰
idx?.uiText_title.text = "Hello";

// 2) findByï¼šæŒ‰ç±»å‹/è°“è¯æ£€ç´¢ï¼Œel è‡ªåŠ¨æ”¶çª„
const imgs = idx?.findBy("UiImage", (meta, el) => el?.visible === true);
const buttons = idx?.findBy((meta) => meta.name.includes("btn"));
```

## å¦‚ä½•è·å–å¹¶ä½¿ç”¨

### ç”Ÿæˆç´¢å¼•æ–‡ä»¶

- è§¦å‘â€œåŒæ­¥åœ°å›¾èµ„æºâ€ï¼ˆä¾‹å¦‚æŒ‰ä¸‹ `Alt+Y`ï¼‰æˆ–ç›¸å…³å‘½ä»¤åï¼Œæ’ä»¶ä¼šæ‰«æ UI æ ‘å¹¶è‡ªåŠ¨ç”Ÿæˆç´¢å¼•æ–‡ä»¶ã€‚
- ç”Ÿæˆç›®å½•ç»“æ„å¦‚ä¸‹ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œå‹¿æ‰‹åŠ¨ä¿®æ”¹ï¼‰ï¼š

```
client/UiIndex/
  â”œâ”€ index.ts                // å…¥å£ï¼Œé»˜è®¤å¯¼å‡º find()
  â”œâ”€ ClientUIWindow.ts       // åŸºç±»ï¼ˆç¼“å­˜ã€æŒ‰è·¯å¾„æŸ¥æ‰¾ã€é¢„çƒ­é€»è¾‘ + å®ç”¨æ–¹æ³•ï¼‰
  â””â”€ screens/
      â”œâ”€ UiIndex_home.ts     // ç¤ºä¾‹ï¼šhome å±å¹•ç´¢å¼•ç±»
      â””â”€ UiIndex_xxx.ts      // å…¶å®ƒå±å¹•ç´¢å¼•ç±»
```

> è‹¥ä½ çœ‹åˆ°å¯¼å…¥è·¯å¾„ä¸º `@client/UiIndex`ï¼Œè¯´æ˜å·²åœ¨é¡¹ç›®ä¸­é…ç½®äº†è¯¥åˆ«åï¼Œé€šå¸¸å¯ç›´æ¥ä½¿ç”¨è¯¥å¯¼å…¥æ–¹å¼ã€‚

### å¿«é€Ÿä¸Šæ‰‹

```ts
import find from "@client/UiIndex";

// 1) é€šè¿‡å±å¹•åè·å–ç´¢å¼•å®ä¾‹ï¼ˆå¼ºç±»å‹ï¼‰
const idx = find("blackground");
if (idx) {
  // 2) ç›´æ¥é€šè¿‡å¼ºç±»å‹å±æ€§è®¿é—® UI å…ƒç´ 
  // å®é™…è·¯å¾„ï¼šblackground/box/unit/list/0/uiText_content1
  idx.uiText_content1; // åªéœ€è¦å†™ uiText_content1ï¼Œå°±å¯ä»¥è®¿é—®åˆ°
  idx.uiImage_logo; // åŒç†
}
```

è¦ç‚¹ï¼š

- `find(name)` çš„è¿”å›ç±»å‹ç”± `name` å†³å®šï¼š
  - åœ¨ç±»å‹ä¸Šå­˜åœ¨çš„å±å¹•å -> è¿”å›è¯¥å±å¹•å¯¹åº”çš„ `UiIndex_xxx` å®ä¾‹ç±»å‹ã€‚
  - ä¸å­˜åœ¨çš„å±å¹•å -> è¿”å›ç±»å‹ä¸º `never`ï¼ˆç¼–è¯‘æœŸç«‹å³æš´éœ²é—®é¢˜ï¼‰ã€‚
- è¿è¡Œæ—¶å¦‚æœç¡®å®æœªæ‰¾åˆ°è¯¥å±å¹•ï¼Œä¼šè¿”å› `undefined`ï¼Œå› æ­¤ç¤ºä¾‹é‡Œæœ‰åˆ¤ç©ºã€‚
- æ€§èƒ½ï¼šåŒä¸€å±å¹•åçš„ `find(name)` ä¼šè¢«ç¼“å­˜ï¼Œåç»­é‡å¤è°ƒç”¨ç›´æ¥å¤ç”¨å®ä¾‹ï¼Œä¸ä¼šé‡å¤æ„å»ºã€‚

### å¸¸ç”¨æ“ä½œæ¸…å•

- **è·å–ç´¢å¼•å®ä¾‹**ï¼š`const idx = find("home")`ï¼Œå¹¶åˆ¤ç©ºå¤„ç†ã€‚
- **è®¿é—®å…ƒç´ **ï¼š`idx.uiText_title`ã€`idx.uiImage_logo` ç­‰å±æ€§å³ä¸ºå…ƒç´ å¼•ç”¨ã€‚
- **æŸ¥çœ‹çœŸå®è·¯å¾„**ï¼šæ‰“å¼€å¯¹åº” `UiIndex_<Screen>.ts`ï¼ŒæŸ¥é˜… `static PATHS` æˆ– getter æ³¨é‡Šã€‚
- **ç»“æ„æ”¹åŠ¨å**ï¼šé‡æ–°åŒæ­¥èµ„æºä»¥æ›´æ–°ç´¢å¼•ï¼Œé¿å…æ‰‹å†™è·¯å¾„å¸¦æ¥çš„ç»´æŠ¤æˆæœ¬ã€‚

## UI æ•°æ®

- **ç»Ÿä¸€å…ƒä¿¡æ¯ METAï¼ˆå¼ºç±»å‹ï¼‰**

  - æ¯ä¸ªå±å¹•ç±»éƒ½ç”Ÿæˆ `static readonly META`ï¼Œä¸ `PATHS` ä¸€ä¸€å¯¹åº”ã€‚
  - `META[i].path` ä¸å†é‡å¤å­—ç¬¦ä¸²ï¼Œæ”¹ä¸ºå¼•ç”¨ `PATHS[i]`ï¼Œå•ä¸€æ¥æºæ›´ç¨³ã€‚
  - `META[i].type` æ”¶ç´§ä¸ºè”åˆç±»å‹ï¼š`'UiBox' | 'UiImage' | 'UiInput' | 'UiScrollBox' | 'UiText'`ã€‚

- **findBy ä¸‹æ²‰åˆ°åŸºç±»å¹¶å¢å¼ºç±»å‹**

  - ç°ä½äº `ClientUIWindow`ï¼Œæ‰€æœ‰å±å¹•ç±»ç›´æ¥ç»§æ‰¿ã€‚
  - æ”¯æŒä¸¤ç§è°ƒç”¨æ–¹å¼ï¼š
    - `findBy(predicate)`ï¼šæŒ‰è°“è¯è¿‡æ»¤ï¼Œ`el` ç±»å‹ä¸º `UiElement | undefined`ã€‚
    - `findBy(kind, predicate?)`ï¼šå…ˆæŒ‰ç±»å‹è¿‡æ»¤ï¼Œ`el` ä¼šéš `kind` è‡ªåŠ¨æ”¶çª„ä¸ºå¯¹åº”ç±»å‹ï¼ˆä¾‹å¦‚ `UiImage | undefined`ï¼‰ã€‚
  - è¿”å›å€¼ï¼šæœ‰å‘½ä¸­ -> è¿”å›å‘½ä¸­æ•°ç»„ï¼›æ— å‘½ä¸­ -> `undefined`ã€‚
  - ç¤ºä¾‹ï¼š
    ```ts
    const texts = idx?.findBy("UiText");
    const imgs = idx?.findBy("UiImage", (meta, el) => el?.visible === true);
    const hits = idx?.findBy((meta, el) => meta.name.includes("btn"));
    ```

- **å®ä¾‹æ–¹æ³•ï¼šgetPaths / getMeta**

  - `getPaths(): ReadonlyArray<string>` è¿”å›å½“å‰å±å¹•çš„ `PATHS`ã€‚
  - `getMeta(): ReadonlyArray<{ path: string; type: UiKind; name: string }>` è¿”å› `META`ï¼ˆä¾¿äºè°ƒè¯•/å¯è§†åŒ–ï¼‰ã€‚

## API å‚è€ƒ

### 1) é»˜è®¤å¯¼å‡ºï¼šfind(screenName)

- ä½œç”¨ï¼šé€šè¿‡å±å¹•åè·å–è¯¥å±å¹•å¯¹åº”çš„ UI ç´¢å¼•å®ä¾‹ã€‚
- ç±»å‹ï¼ˆç®€åŒ–ç¤ºæ„ï¼‰ï¼š
  ```ts
  export default function find<Name extends keyof typeof __UiIndexCtorMap>(
    screenName: Name
  ): InstanceType<(typeof __UiIndexCtorMap)[Name]> | undefined;
  ```
- è¿è¡Œæ—¶è¿”å›ï¼š`UiIndex_xxx` å®ä¾‹æˆ– `undefined`ï¼ˆå±å¹•ä¸å­˜åœ¨ï¼‰ã€‚
- å…¸å‹ç”¨æ³•ï¼š
  ```ts
  const idx = find("home");
  if (idx) {
    idx.uiText_title;
  }
  ```

### 2) å±å¹•ç´¢å¼•ç±»ï¼š`UiIndex_<Screen>`

- æ¯ä¸ªå±å¹•å¯¹åº”ä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ª `ClientUIWindow`ã€‚
- ä¸»è¦æˆå‘˜ï¼š
  - `static readonly PATHS: readonly string[]`ï¼šè¯¥å±å¹•ä¸‹éœ€ç¼“å­˜çš„å®Œæ•´è·¯å¾„è¡¨ã€‚
  - `static readonly META: readonly { path: (typeof PATHS)[number]; type: UiKind; name: string }[]`ã€‚
  - å¼ºç±»å‹ gettersï¼šä¾‹å¦‚ `get uiText_title(): UiText`ï¼ˆä»ç¼“å­˜ä¸­æŒ‰ `PATHS[i]` è¯»å–ï¼‰ã€‚

### 3) åŸºç±»ï¼š`ClientUIWindow`

- èŒè´£ï¼š
  - ç»´æŠ¤ä»¥å®Œæ•´è·¯å¾„ä¸ºé”®çš„ç¼“å­˜è¡¨ `__cache`ã€‚
  - æä¾› `getByPath(path)` æ ¹æ®å®Œæ•´è·¯å¾„æŸ¥æ‰¾å…ƒç´ ã€‚
  - æ„é€ æ—¶æŒ‰ `PATHS` è¿›è¡Œé¢„çƒ­ï¼Œå°†æ‰€æœ‰è·¯å¾„æ˜ å°„åˆ°ç¼“å­˜ã€‚
- å…³é”®æ–¹æ³•ï¼ˆæ–°å¢ä¸è°ƒæ•´ï¼‰ï¼š
  - `getPaths(): ReadonlyArray<string>`
  - `getMeta(): ReadonlyArray<{ path: string; type: UiKind; name: string }>`
  - `findBy(kind, predicate?)` / `findBy(predicate)`ï¼šå¸¦ç±»å‹æ”¶çª„ä¸ç©ºè¿”å› `undefined` çš„è¿‡æ»¤ã€‚

> ç±»å‹åˆ«åï¼š`type UiKind = 'UiBox' | 'UiImage' | 'UiInput' | 'UiScrollBox' | 'UiText'`

## å‘½åè§„åˆ™

- å±æ€§åå‰ç¼€ä¸ç±»å‹ç»‘å®šï¼š
  - `UiText` -> `uiText_...`
  - `UiImage` -> `uiImage_...`
  - `UiBox` -> `uiBox_...`
  - `UiScrollBox` -> `uiScrollBox_...`
  - `UiInput` -> `uiInput_...`
- åŸºç¡€å‘½åä½¿ç”¨â€œè·¯å¾„æœ€åä¸€æ®µåâ€ï¼›è‹¥å†²çªï¼Œåˆ™å›é€€ä¸ºâ€œå®Œæ•´è·¯å¾„â€ï¼›è‹¥ä»å†²çªï¼Œè‡ªåŠ¨è¿½åŠ åºå· `_2/_3/...`ã€‚
- æ”¯æŒä¸­æ–‡/Unicodeï¼Œéæ³•å­—ç¬¦å°†è¢«æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œå¹¶ç¡®ä¿é¦–å­—ç¬¦åˆæ³•ã€‚

## uiIndexPrefix é…ç½®ä¸è¡Œä¸º

- **é…ç½®ä½ç½®**ï¼š`dao3.config.json -> file.typescript.client.uiIndexPrefix`
- **ç±»å‹ä¸é»˜è®¤å€¼**ï¼šå­—ç¬¦ä¸²ï¼Œé»˜è®¤ç©ºå­—ç¬¦ä¸² `""`ï¼ˆä¸å¯ç”¨è¿‡æ»¤ï¼‰
- **åŠŸèƒ½è¯´æ˜**ï¼š
  - è‹¥é…ç½®äº†å‰ç¼€ï¼Œä¾‹å¦‚ `"U_"`ï¼Œåˆ™ä»…æ”¶é›†åç§°ä»¥è¯¥å‰ç¼€å¼€å¤´çš„ UI èŠ‚ç‚¹æ¥ç”Ÿæˆç´¢å¼•ã€‚
  - ç”Ÿæˆçš„ getter åä¼šè‡ªåŠ¨å‰¥ç¦»è¯¥å‰ç¼€ï¼Œé¿å…å‡ºç° `uiText_U_title` è¿™ç§å†—ä½™å‘½åã€‚
  - æœªé…ç½®æˆ–ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œå¯¹æ‰€æœ‰èŠ‚ç‚¹ç”Ÿæˆç´¢å¼•ã€‚

ç¤ºä¾‹é…ç½®ï¼š

```json
{
  "file": {
    "typescript": {
      "client": {
        "uiIndexPrefix": "U_"
      }
    }
  }
}
```

ç¤ºä¾‹æ•ˆæœï¼š

- èŠ‚ç‚¹å®é™…åç§°ï¼š`U_title`ã€`U_logo`ã€`desc`
- ç”Ÿæˆç»“æœï¼š
  - `U_title` -> getter: `uiText_title`
  - `U_logo` -> getter: `uiImage_logo`
  - `desc` -> ä¸ç”Ÿæˆï¼ˆæœªåŒ¹é…å‰ç¼€ï¼‰
- PATHS ä¸­ä¿ç•™çœŸå®åç§°ï¼ˆå¦‚ `.../U_title`ï¼‰ï¼Œä»… getter åå‰¥ç¦»å‰ç¼€ï¼Œè¿è¡Œæ—¶æŸ¥æ‰¾ä¸å—å½±å“ã€‚

## æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

- ä»…æ”¯æŒå•ä¸ªå‰ç¼€å­—ç¬¦ä¸²ã€‚è‹¥éœ€å¤šä¸ªå‰ç¼€æˆ–æ­£åˆ™åŒ¹é…ï¼Œè¯·æéœ€æ±‚ï¼Œå¯æ‰©å±•ä¸ºæ•°ç»„/æ­£åˆ™ã€‚
- å»ºè®®ç»Ÿä¸€ç»™â€œéœ€è¦æš´éœ²ä¸ºç´¢å¼•â€çš„èŠ‚ç‚¹åŠ ä¸Šå‰ç¼€ï¼Œä»¥å‡å°‘å™ªå£°å’Œå±æ€§å†²çªã€‚
- ä¿®æ”¹å‰ç¼€åè¯·é‡æ–°åŒæ­¥èµ„æºï¼Œä»¥æ›´æ–°ç´¢å¼•æ–‡ä»¶ã€‚
- å‘½åå†²çªå¤„ç†ä»ç”Ÿæ•ˆï¼šæœ«çº§åå†²çª -> å›é€€å…¨è·¯å¾„ -> å†è¿½åŠ åºå·ã€‚
